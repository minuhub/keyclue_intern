<!DOCTYPE html>
	<html>
		<head>
			<% include ../partials/header.ejs %>
		</head>
		<body>
	<% include ../partials/nav.ejs %>
		<!-- <div class="radio-btn">
			<input type="radio" name="r1" onclick="show(this.value);" value="g_sheet" checked />Google Sheet
			<input type="radio" name="r1" onclick="show(this.value);"  value="csv"/>CSV
			</div>
			<form id="g_sheet" action="" name="form" method="post">
				<div class="col-lg-12">
					<div class="in-input">
						<input  class="form-control " type="text" Placeholder="Paste your Spreadsheet ID here" name="sheet_url" />
					</div>
							
					<div class="in-btn">
						<input class="btn btn-primary" type="submit" name="submit" value="sync">
					</div>
				</div>
			</form>
			<form id="csv" style="display:none;"action="" name="form" method="post">
				<div class="col-lg-12">
					<div class="in-input">
						<input  class=" " type="File" Placeholder="Paste your Spreadsheet ID here" name="csv" />
					</div>
					<div class="in-btn">
						<input class="btn btn-primary" type="submit" name="submit" value="sync">
					</div>
				</div>
			</form>
		 -->	<div class="container">
				<% if(data != ""){ %>
				<div class="scrool">
					<table id = "example" class="table table-bordered">
						<thead>
							<tr>
								<th>
									<select id="dropdown1" style="width: 100%;">
										<option>SPU</option>
									</select> 
								</th>
								<th>
									<select id="dropdown2" style="width: 100%;">
										<option>SKU</option>
									</select>
								</th>
								<th>
									<select id="dropdown3" style="width: 100%;">
										<option>BARCODE NUMBER</option>
									</select>
								</th>
								<th>
									<select id="dropdown4" style="width: 100%;">
										<option>BRAND</option>
									</select> 
								</th>
								<th class=""> 
									<select id="dropdown5" style="width: 100%;">
										<option>PRODUCT NAME</option>
									</select>
								</th>
								<th>
									<select id="dropdown6" style="width: 100%;">
										<option>TAG PRICE</option>
									</select>
								</th>
								<th>
									<select id="dropdown7" style="width: 100%;">
										<option>SALE PRICE</option>
									</select>
								</th>
								<th>
									<select id="dropdown8" style="width: 100%;">
										<option>IMAGE</option>
									</select>
								</th>
								<th>
									<select id="dropdown9" style="width: 100%;">
										<option>FABRIC</option>
									</select>
								</th>
						<th><select id="dropdown10" style="width: 100%;">
						  <option>HS CODE</option>
						</select> </th>
						<th><select id="dropdown11" style="width: 100%;">
						  <option>(Tmall only)</option>
						</select> </th>
						<th><select id="dropdown12" style="width: 100%;">
						  <option>(Tmall only)0</option>
						</select> </th>
						<th><select id="dropdown13" style="width: 100%;">
						  <option>(Tmall only)1</option>
						</select> </th>
						<th><select id="dropdown14" style="width: 100%;">
						  <option>(Tmall only)2</option>
						</select> </th>
						<th><select id="dropdown15" style="width: 100%;">
						  <option>(Tmall only)3</option>
						</select> </th>
						<th><select id="dropdown16" style="width: 100%;">
						  <option>MADE IN</option>
						</select> </th>
						<th><select id="dropdown17" style="width: 100%;">
						  <option>WEIGHT(kg)</option>
						</select> </th>
						<th><select id="dropdown18" style="width: 100%;">
						  <option>HOW TO WASH</option>
						</select> </th>
						<th><select id="dropdown19" style="width: 100%;">
						  <option>SELLING POINT (description)</option>
						</select> </th>
						<th><select id="dropdown20" style="width: 100%;">
						  <option>PRODUCT PRICE</option>
						</select> </th>
						<th><select id="dropdown21" style="width: 100%;">
						  <option>SHIPPING FEE</option>
						</select> </th>
						<th><select id="dropdown22" style="width: 100%;">
						  <option>TOTAL PRICE(U+V)</option>
						</select> </th>
						<th><select id="dropdown23" style="width: 100%;">
						  <option>TOTAL PRICE(U+V)1</option>
						</select> </th>
					</tr>
					</thead>
					<tbody>
							<% for(let i = 0; i < data.length; i++) { %>
		<% var pDetail =  data[i].product_details; %>
		<% for(let k = 0; k < pDetail.length; k++) { %>
						<tr>
							<td><%=  pDetail[k].spu %></td>
							<td><%=  pDetail[k].sku %></td>
							<td><%=  pDetail[k].barcode_number %></td>
							<td><%=  pDetail[k].brand %></td>
							<td><%=  pDetail[k].product_name %></td>
							<td><%=  pDetail[k].tag_price %></td>
							<td><%=  pDetail[k].sale_price %></td>
							<td><%=  pDetail[k].image %></td>
							<td><%=  pDetail[k].fabric %></td>
							<td><%=  pDetail[k].tmall %></td>
							<td><%=  pDetail[k].tmall_0 %></td>
							<td><%=  pDetail[k].tmall_1 %></td>
							<td><%=  pDetail[k].tmall_2 %></td>
							<td><%=  pDetail[k].tmall_3 %></td>
							<td><%=  pDetail[k].made_in %></td>
							<td><%=  pDetail[k].weight_in_kg %></td>
							<td><%=  pDetail[k].how_to_wash %></td>
							<td><%=  pDetail[k].selling_point%></td>
							<td><%=  pDetail[k].product_price %></td>
							<td><%=  pDetail[k].shipping_fee %></td>
							<td><%=  pDetail[k].total_price %></td>
							<td><%=  pDetail[k].total_price_1 %></td>
							<td><%=  pDetail[k].total_price_1 %></td>
						</tr>
						<%  } %>
			<%  } %>   
			
					</tbody>
					</table>
				</div>
				<form action="/save_record" method="post" id="save_data">
				<input type="hidden" name="data" id="data" value="">
				<input type="hidden" name="data_base"  value="<%= data_base %>">   
				<input type="hidden" name="brand_id"  value="<%= brand_id %>">   
				<a id="save" class="custom-btn btn btn-primary" href="javascript:void(0);">Save</a>
				</form>
				<%  }else{ %>  
					<tr><td colspan="8">No Product in database</td></tr>
			
			<%  } %>   
				
			</div>
			
			<script>
			
		$(document).ready(function() {
			$('table').SetEditable();
			<!-- $('#example').dataTable();  -->
		
			$("#save").click(function() {
					var values = $('th > select option:selected').map(function() {
				return this.value;
			}).toArray();

			var hasDups = !values.every(function(v,i) {
			
				return values.indexOf(v) == i;
			});

				if (hasDups){
					alert("Two or more column have same headings.Heading must be unique");
				}else{
				var mainArray =[];
				var d = new Date();

				var month = d.getMonth()+1;
			var day = d.getDate();

				var currentTime = d.getFullYear() + '/' + (month<10 ? '0' : '') + month + '/' + (day<10 ? '0' : '') + day +" "+ d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
				
 					$("table").find('tr').each(function (i, el) {
				var innerElement = {"created_date":currentTime, "modified_date":currentTime};
						var $tds  = $(this).find('td');
						var $ths  = $( "th > select option:selected" );
						 for(k=0;k<23;k++){ 
							column = $ths.eq(k).val();
							value = $tds.eq(k).text();
							
							innerElement[column] = value;
						 
						 }
						
						 mainArray.push(innerElement);
							
						<!-- alert(JSON.stringify(mainArray)); -->
						
					});
					$('#data').val(JSON.stringify(mainArray));
					$('#save_data').submit();
				}
			});
			accountName = {"spu":"SPU", "sku":"SKU", "barcode_number":"BARCODE NUMBER", "brand":"BRAND", "product_name":"PRODUCT NAME", "tag_price":"TAG PRICE", "sale_price":"SALE PRICE", "image":"IMAGE", "fabric":"FABRIC", "hs_code":"HS CODE", "tmall":"(Tmall only)", "tmall_0":"(Tmall only)0", "tmall_1":"(Tmall only)1",	"tmall_2":"(Tmall only)2", "tmall_3":"(Tmall only)3",	"made_in":"MADE IN", "weight_in_kg":"WEIGHT(kg)", "how_to_wash":"HOW TO WASH",	"selling_point":"SELLING POINT (description)", "product_price":"PRODUCT PRICE",	"shipping_fee":"SHIPPING FEE",	"total_price":"TOTAL PRICE(U+V)", "total_price_1":"TOTAL PRICE(U+V)1" };
			var loop = $("th").length;
			for(var i =1;i< loop;i++){
				var selected = $("#dropdown"+i).val();
				$("#dropdown"+i).empty();
				$.each(accountName, function( key, value) {   
				<!-- alert(key,value); -->
					if(selected == value){ var select = 'selected';}else{ var select = '';}
					$('#dropdown'+i).append($("<option "+ select+" ></option>")
									.attr("value",key)
									.text(value)); 
				});
			}	
		} );
		function show(val){
			if(val == "csv"){
				$("#csv").show();
				$("#g_sheet").hide();
			}else{
				$("#csv").hide();
				$("#g_sheet").show();
			}
		}
</script>
			
		</body>
	</html>
